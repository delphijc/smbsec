<!DOCTYPE html>
<html lang="en" dir="auto" data-theme="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Chapter 10 – Practical Implementation Guide | AI enabled blue team operations for small to medium size businesses</title>
<meta name="keywords" content="">
<meta name="description" content="Chapter 10 – Practical Implementation Guide
10.1 Overview
This chapter provides a step‑by‑step blueprint for building, deploying, and maintaining the AI‑powered security stack described in the book. It assumes a small security team (5–15 analysts) with basic DevOps skills.
10.2 Prerequisites

Hardware – At least one GPU‑enabled VM (e.g., NVIDIA T4) and one general‑purpose VM.
Software – Docker, Docker‑Compose, Python 3.10&#43;, Node 18&#43;, and Terraform (optional).
Credentials – Access to cloud provider (AWS, GCP, Azure) or on‑prem infrastructure.
Team – 1–2 data scientists, 1–2 security engineers, 1–2 analysts.

10.3 Infrastructure Setup

Provision VMs – Use Terraform to spin up:

elastic-node (4 vCPU, 16 GB RAM)
gpu-node (1 x NVIDIA T4, 8 GB VRAM)


Networking – Create a private subnet; expose only necessary ports (5601 for Kibana, 9200 for Elasticsearch, 5000 for FastAPI).
Security Groups – Restrict inbound traffic to internal IPs; enable TLS termination.

10.4 Elastic Stack Installation
# On elastic-node
sudo apt-get update &amp;&amp; sudo apt-get install -y apt-transport-https openjdk-11-jre
wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.17.0-amd64.deb
sudo dpkg -i elasticsearch-7.17.0-amd64.deb
sudo systemctl enable elasticsearch &amp;&amp; sudo systemctl start elasticsearch

# Install Kibana
wget https://artifacts.elastic.co/downloads/kibana/kibana-7.17.0-amd64.deb
sudo dpkg -i kibana-7.17.0-amd64.deb
sudo systemctl enable kibana &amp;&amp; sudo systemctl start kibana

Enable the SIEM app via Kibana UI.
Configure Beats to ship logs to elastic-node.

10.5 Wazuh Deployment
# On elastic-node
sudo apt-get install -y wazuh-manager
sudo systemctl enable wazuh-manager &amp;&amp; sudo systemctl start wazuh-manager
# On each endpoint
sudo apt-get install -y wazuh-agent
sudo systemctl enable wazuh-agent &amp;&amp; sudo systemctl start wazuh-agent

Configure Wazuh to forward alerts to Elastic SIEM.

10.6 OpenCTI Setup
# On elastic-node
docker run -d --name opencti -p 8080:8080 opencti/platform:latest
# Create admin user via UI

Import initial threat feeds (MISP, AlienVault).
Expose the REST/TAXII API.

10.7 Model Training &amp; Serving

Data Preparation – Collect 3 months of logs, label a subset.
Fine‑Tune Llama‑2 – Use Hugging Face transformers.
from transformers import AutoModelForCausalLM, AutoTokenizer
model = AutoModelForCausalLM.from_pretrained(&#34;meta-llama/Llama-2-7b-chat-hf&#34;)
tokenizer = AutoTokenizer.from_pretrained(&#34;meta-llama/Llama-2-7b-chat-hf&#34;)
# Fine‑tune on log summaries

Serve with FastAPI – Deploy on gpu-node.
from fastapi import FastAPI
app = FastAPI()
@app.post(&#34;/summarize&#34;)
async def summarize(log: str):
    # Tokenize, generate, return summary

RL Playbook – Train Stable‑Baselines3 PPO policy.
from stable_baselines3 import PPO
model = PPO(&#34;MlpPolicy&#34;, env, verbose=1)
model.save(&#34;playbook_policy.zip&#34;)

Serve RL Policy – Expose via FastAPI.

10.8 Orchestration Layer

Deploy a Flask app that receives alerts from Elastic SIEM, calls the LLM summarizer, queries OpenCTI, and invokes the RL policy.
Use Celery for background tasks.
Store audit logs in PostgreSQL.

10.9 Automation &amp; CI/CD

GitHub Actions – Build Docker images, run unit tests, and deploy to VMs.
Ansible – Provision and configure services.
Prometheus &#43; Grafana – Monitor CPU, GPU, memory, and model latency.

10.10 Security Hardening

Enable TLS for all services.
Use HashiCorp Vault for secrets.
Rotate API keys weekly.
Run regular vulnerability scans with OpenVAS.

10.11 Maintenance Checklist

  
      
          Task
          Frequency
          Owner
      
  
  
      
          Model Retraining
          Monthly
          Data Scientist
      
      
          Log Retention Policy
          Quarterly
          Security Engineer
      
      
          Compliance Audit
          Annually
          Compliance Officer
      
      
          Infrastructure Scaling
          As needed
          DevOps
      
      
          Incident Review
          After each incident
          Analyst
      
  

10.12 Summary
By following this guide, a small security team can deploy a full AI‑powered security stack that delivers real‑time detection, automated response, and continuous improvement—all while staying within budget constraints.">
<meta name="author" content="delphijc">
<link rel="canonical" href="//localhost:1313/chapter10/">
<link crossorigin="anonymous" href="../assets/css/stylesheet.f6853c0d9335d13ee38ea4c37958cedb9b4b080fce2060db60440b49c0cf1e1d.css" integrity="sha256-9oU8DZM10T7jjqTDeVjO25tLCA/OIGDbYEQLScDPHh0=" rel="preload stylesheet" as="style">
<link rel="icon" href="//localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="//localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="//localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="//localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="//localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="//localhost:1313/chapter10/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
                color-scheme: dark;
            }

            .list {
                background: var(--theme);
            }

            .toc {
                background: var(--entry);
            }
        }

        @media (prefers-color-scheme: light) {
            .list::-webkit-scrollbar-thumb {
                border-color: var(--code-bg);
            }
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    } else if (localStorage.getItem("pref-theme") === "light") {
       document.querySelector("html").dataset.theme = 'light';
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.querySelector("html").dataset.theme = 'dark';
    } else {
        document.querySelector("html").dataset.theme = 'light';
    }

</script>
</head>
<body id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="//localhost:1313/" accesskey="h" title="AI enabled blue team operations for small to medium size businesses (Alt + H)">AI enabled blue team operations for small to medium size businesses</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="//localhost:1313/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="//localhost:1313/chapter1/" title="Chapter 1">
                    <span>Chapter 1</span>
                </a>
            </li>
            <li>
                <a href="//localhost:1313/chapter2/" title="Chapter 2">
                    <span>Chapter 2</span>
                </a>
            </li>
            <li>
                <a href="//localhost:1313/chapter3/" title="Chapter 3">
                    <span>Chapter 3</span>
                </a>
            </li>
            <li>
                <a href="//localhost:1313/chapter4/" title="Chapter 4">
                    <span>Chapter 4</span>
                </a>
            </li>
            <li>
                <a href="//localhost:1313/chapter5/" title="Chapter 5">
                    <span>Chapter 5</span>
                </a>
            </li>
            <li>
                <a href="//localhost:1313/chapter6/" title="Chapter 6">
                    <span>Chapter 6</span>
                </a>
            </li>
            <li>
                <a href="//localhost:1313/chapter7/" title="Chapter 7">
                    <span>Chapter 7</span>
                </a>
            </li>
            <li>
                <a href="//localhost:1313/chapter8/" title="Chapter 8">
                    <span>Chapter 8</span>
                </a>
            </li>
            <li>
                <a href="//localhost:1313/chapter9/" title="Chapter 9">
                    <span>Chapter 9</span>
                </a>
            </li>
            <li>
                <a href="//localhost:1313/chapter10/" title="Chapter 10">
                    <span class="active">Chapter 10</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Chapter 10 – Practical Implementation Guide
    </h1>
    <div class="post-meta"><span title='2025-11-28 00:00:00 +0000 UTC'>November 28, 2025</span>&nbsp;·&nbsp;<span>3 min</span>&nbsp;·&nbsp;<span>delphijc</span>

</div>
  </header> 
  <div class="post-content"><h1 id="chapter10--practical-implementation-guide">Chapter 10 – Practical Implementation Guide<a hidden class="anchor" aria-hidden="true" href="#chapter10--practical-implementation-guide">#</a></h1>
<h2 id="101-overview">10.1 Overview<a hidden class="anchor" aria-hidden="true" href="#101-overview">#</a></h2>
<p>This chapter provides a step‑by‑step blueprint for building, deploying, and maintaining the AI‑powered security stack described in the book. It assumes a small security team (5–15 analysts) with basic DevOps skills.</p>
<h2 id="102-prerequisites">10.2 Prerequisites<a hidden class="anchor" aria-hidden="true" href="#102-prerequisites">#</a></h2>
<ul>
<li><strong>Hardware</strong> – At least one GPU‑enabled VM (e.g., NVIDIA T4) and one general‑purpose VM.</li>
<li><strong>Software</strong> – Docker, Docker‑Compose, Python 3.10+, Node 18+, and Terraform (optional).</li>
<li><strong>Credentials</strong> – Access to cloud provider (AWS, GCP, Azure) or on‑prem infrastructure.</li>
<li><strong>Team</strong> – 1–2 data scientists, 1–2 security engineers, 1–2 analysts.</li>
</ul>
<h2 id="103-infrastructure-setup">10.3 Infrastructure Setup<a hidden class="anchor" aria-hidden="true" href="#103-infrastructure-setup">#</a></h2>
<ol>
<li><strong>Provision VMs</strong> – Use Terraform to spin up:
<ul>
<li><code>elastic-node</code> (4 vCPU, 16 GB RAM)</li>
<li><code>gpu-node</code> (1 x NVIDIA T4, 8 GB VRAM)</li>
</ul>
</li>
<li><strong>Networking</strong> – Create a private subnet; expose only necessary ports (5601 for Kibana, 9200 for Elasticsearch, 5000 for FastAPI).</li>
<li><strong>Security Groups</strong> – Restrict inbound traffic to internal IPs; enable TLS termination.</li>
</ol>
<h2 id="104-elastic-stack-installation">10.4 Elastic Stack Installation<a hidden class="anchor" aria-hidden="true" href="#104-elastic-stack-installation">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># On elastic-node</span>
</span></span><span style="display:flex;"><span>sudo apt-get update <span style="color:#f92672">&amp;&amp;</span> sudo apt-get install -y apt-transport-https openjdk-11-jre
</span></span><span style="display:flex;"><span>wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.17.0-amd64.deb
</span></span><span style="display:flex;"><span>sudo dpkg -i elasticsearch-7.17.0-amd64.deb
</span></span><span style="display:flex;"><span>sudo systemctl enable elasticsearch <span style="color:#f92672">&amp;&amp;</span> sudo systemctl start elasticsearch
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Install Kibana</span>
</span></span><span style="display:flex;"><span>wget https://artifacts.elastic.co/downloads/kibana/kibana-7.17.0-amd64.deb
</span></span><span style="display:flex;"><span>sudo dpkg -i kibana-7.17.0-amd64.deb
</span></span><span style="display:flex;"><span>sudo systemctl enable kibana <span style="color:#f92672">&amp;&amp;</span> sudo systemctl start kibana
</span></span></code></pre></div><ul>
<li>Enable the SIEM app via Kibana UI.</li>
<li>Configure Beats to ship logs to <code>elastic-node</code>.</li>
</ul>
<h2 id="105-wazuh-deployment">10.5 Wazuh Deployment<a hidden class="anchor" aria-hidden="true" href="#105-wazuh-deployment">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># On elastic-node</span>
</span></span><span style="display:flex;"><span>sudo apt-get install -y wazuh-manager
</span></span><span style="display:flex;"><span>sudo systemctl enable wazuh-manager <span style="color:#f92672">&amp;&amp;</span> sudo systemctl start wazuh-manager
</span></span><span style="display:flex;"><span><span style="color:#75715e"># On each endpoint</span>
</span></span><span style="display:flex;"><span>sudo apt-get install -y wazuh-agent
</span></span><span style="display:flex;"><span>sudo systemctl enable wazuh-agent <span style="color:#f92672">&amp;&amp;</span> sudo systemctl start wazuh-agent
</span></span></code></pre></div><ul>
<li>Configure Wazuh to forward alerts to Elastic SIEM.</li>
</ul>
<h2 id="106-opencti-setup">10.6 OpenCTI Setup<a hidden class="anchor" aria-hidden="true" href="#106-opencti-setup">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># On elastic-node</span>
</span></span><span style="display:flex;"><span>docker run -d --name opencti -p 8080:8080 opencti/platform:latest
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create admin user via UI</span>
</span></span></code></pre></div><ul>
<li>Import initial threat feeds (MISP, AlienVault).</li>
<li>Expose the REST/TAXII API.</li>
</ul>
<h2 id="107-model-training--serving">10.7 Model Training &amp; Serving<a hidden class="anchor" aria-hidden="true" href="#107-model-training--serving">#</a></h2>
<ol>
<li><strong>Data Preparation</strong> – Collect 3 months of logs, label a subset.</li>
<li><strong>Fine‑Tune Llama‑2</strong> – Use Hugging Face <code>transformers</code>.
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> transformers <span style="color:#f92672">import</span> AutoModelForCausalLM, AutoTokenizer
</span></span><span style="display:flex;"><span>model <span style="color:#f92672">=</span> AutoModelForCausalLM<span style="color:#f92672">.</span>from_pretrained(<span style="color:#e6db74">&#34;meta-llama/Llama-2-7b-chat-hf&#34;</span>)
</span></span><span style="display:flex;"><span>tokenizer <span style="color:#f92672">=</span> AutoTokenizer<span style="color:#f92672">.</span>from_pretrained(<span style="color:#e6db74">&#34;meta-llama/Llama-2-7b-chat-hf&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Fine‑tune on log summaries</span>
</span></span></code></pre></div></li>
<li><strong>Serve with FastAPI</strong> – Deploy on <code>gpu-node</code>.
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> fastapi <span style="color:#f92672">import</span> FastAPI
</span></span><span style="display:flex;"><span>app <span style="color:#f92672">=</span> FastAPI()
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@app.post</span>(<span style="color:#e6db74">&#34;/summarize&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">summarize</span>(log: str):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Tokenize, generate, return summary</span>
</span></span></code></pre></div></li>
<li><strong>RL Playbook</strong> – Train Stable‑Baselines3 PPO policy.
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> stable_baselines3 <span style="color:#f92672">import</span> PPO
</span></span><span style="display:flex;"><span>model <span style="color:#f92672">=</span> PPO(<span style="color:#e6db74">&#34;MlpPolicy&#34;</span>, env, verbose<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>model<span style="color:#f92672">.</span>save(<span style="color:#e6db74">&#34;playbook_policy.zip&#34;</span>)
</span></span></code></pre></div></li>
<li><strong>Serve RL Policy</strong> – Expose via FastAPI.</li>
</ol>
<h2 id="108-orchestration-layer">10.8 Orchestration Layer<a hidden class="anchor" aria-hidden="true" href="#108-orchestration-layer">#</a></h2>
<ul>
<li>Deploy a Flask app that receives alerts from Elastic SIEM, calls the LLM summarizer, queries OpenCTI, and invokes the RL policy.</li>
<li>Use Celery for background tasks.</li>
<li>Store audit logs in PostgreSQL.</li>
</ul>
<h2 id="109-automation--cicd">10.9 Automation &amp; CI/CD<a hidden class="anchor" aria-hidden="true" href="#109-automation--cicd">#</a></h2>
<ul>
<li><strong>GitHub Actions</strong> – Build Docker images, run unit tests, and deploy to VMs.</li>
<li><strong>Ansible</strong> – Provision and configure services.</li>
<li><strong>Prometheus + Grafana</strong> – Monitor CPU, GPU, memory, and model latency.</li>
</ul>
<h2 id="1010-security-hardening">10.10 Security Hardening<a hidden class="anchor" aria-hidden="true" href="#1010-security-hardening">#</a></h2>
<ul>
<li>Enable TLS for all services.</li>
<li>Use HashiCorp Vault for secrets.</li>
<li>Rotate API keys weekly.</li>
<li>Run regular vulnerability scans with OpenVAS.</li>
</ul>
<h2 id="1011-maintenance-checklist">10.11 Maintenance Checklist<a hidden class="anchor" aria-hidden="true" href="#1011-maintenance-checklist">#</a></h2>
<table>
  <thead>
      <tr>
          <th>Task</th>
          <th>Frequency</th>
          <th>Owner</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Model Retraining</td>
          <td>Monthly</td>
          <td>Data Scientist</td>
      </tr>
      <tr>
          <td>Log Retention Policy</td>
          <td>Quarterly</td>
          <td>Security Engineer</td>
      </tr>
      <tr>
          <td>Compliance Audit</td>
          <td>Annually</td>
          <td>Compliance Officer</td>
      </tr>
      <tr>
          <td>Infrastructure Scaling</td>
          <td>As needed</td>
          <td>DevOps</td>
      </tr>
      <tr>
          <td>Incident Review</td>
          <td>After each incident</td>
          <td>Analyst</td>
      </tr>
  </tbody>
</table>
<h2 id="1012-summary">10.12 Summary<a hidden class="anchor" aria-hidden="true" href="#1012-summary">#</a></h2>
<p>By following this guide, a small security team can deploy a full AI‑powered security stack that delivers real‑time detection, automated response, and continuous improvement—all while staying within budget constraints.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="//localhost:1313/">AI enabled blue team operations for small to medium size businesses</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu');
    if (menu) {
        
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        const html = document.querySelector("html");
        if (html.dataset.theme === "dark") {
            html.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            html.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
